<html>
<head>
  <link rel="stylesheet" href="./reset.css">
  <link rel="stylesheet" href="./style.css">
  <script type="text/javascript" src="./jquery-3.2.1.min.js"></script>
</head>
<body>
  <div id="content">
    <h1>Weather</h1>

    <form class="theForm">
      <label>Location (zip/postal code)
        <input type="text" name="location" id="location" />
      </label>
      <input type="submit" />
    </form>

    <section>
      <h2>Report</h2>
      <p id="report"></p>
    </section>
  </div>

  <script type="text/javascript">
function getWeatherIconURL( id ){
  var valid_ids = [ 1,2,3,4,5,6,7,8,11,12,13,14,15,16,17,18,19,20,
                    21,22,23,24,25,26,29,30,31,32,33,34,35,36,37,38,
                    39,40,41,42,43,44 ];
  if ( typeof(id) !== "undefined" && $.inArray( id, valid_ids ) ){
    return id + "-s.png";
  } else {
    return "";
  }
}

$( ".theForm" ).ready(function() {

  $('.theForm').submit( function(e) {
    var loc = $("#location").val().trim();
    var templ="";

    if ( loc !== "" ){
      var url = "http://70.32.24.233/cgi-bin/weather/fetch.pl?q=" + loc;
      $.getJSON( url, function( data ){
          var dispInfo = { name:data.location.Details.DMA.EnglishName,
                           geo:data.location.GeoPosition.Latitude + ", " +
                               data.location.GeoPosition.Longitude,
                           elev:data.location.GeoPosition.Elevation.Imperial.Value + " " +
                                data.location.GeoPosition.Elevation.Imperial.Unit,
                           timezone:data.location.TimeZone.Code,
                           isDay:data.weather.IsDayTime,
                           link:data.weather.Link,
                           temp:data.weather.Temperature.Imperial.Value + " " +
                                data.weather.Temperature.Imperial.Unit,
                           weatherText:data.weather.WeatherText,
                           weatherIcon:data.weather.WeatherIcon,
                           weatherIconURL:getWeatherIconURL(data.weather.WeatherIcon) };
          console.log(dispInfo);
      });
    }

    e.preventDefault();
  });

});

  </script>

</body>
</html>
